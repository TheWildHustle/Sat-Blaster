(function(i,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("irisdb-nostr"),require("react"),require("irisdb")):typeof define=="function"&&define.amd?define(["exports","irisdb-nostr","react","irisdb"],c):(i=typeof globalThis<"u"?globalThis:i||self,c(i["irisdb-hooks"]={},i.irisdbNostr,i.React,i.irisdb))})(this,function(i,c,o,E){"use strict";function M(e,s,t,u=a=>a,n=!1,r=1,h=!0){o.useEffect(()=>{h&&!t&&e.get(s).once(d=>{t=u(d)},void 0,r)},[e,s,t]);const[a,l]=o.useState(h?t:new Map);o.useEffect(()=>e.get(s).on((f,S,A,w)=>{l(h?u(f):q=>{const v=new Map(q);return v.set(S,u(f)),v}),n&&w()},void 0,r,void 0,h),[e,s,n]);const b=o.useCallback(d=>{e.get(s).put(d)},[e,s]);return[a,b]}function m(e,s,t,u,n=!1,r=1){return M(e,s,t,u,n,r,!0)}function y(e,s,t,u=!1,n=1){return M(e,s,void 0,t,u,n,!1)}function p(e,s,t=n=>n,u=1){return m(E.localState,e,s,t,!1,u)}function P(e,s){const[t]=p("user/publicKey",""),u=o.useMemo(()=>e?e==="follows"?t?[String(t)]:[]:[new c.PublicKey(e).toString()]:[],[t,e]),[n,r]=o.useState(new Set(u));return o.useEffect(()=>{if(t&&e==="follows"){const a=c.ndk().subscribe({kinds:[3],authors:[String(t)]});return a.on("event",l=>{if(l.kind===3){const b=new Set([String(t)]);let d=!1;l.tags.forEach(f=>{if(f[0]==="p")try{new c.Hex(f[1],64),b.has(f[1])||(b.add(f[1]),d=!0)}catch{console.error("Invalid public key",f[1])}}),d&&r(b)}}),()=>a.stop()}},[e,t]),o.useEffect(()=>{const a=new Set(u);if((!n||Array.from(n).sort().toString()!==Array.from(a).sort().toString())&&r(a),!(!e||e==="follows")&&s)return c.publicState(e).get(s).forEach((l,b)=>{r(d=>{const f=b.split("/").pop(),S=new Set(d),A=S.has(f);return l&&!A?(S.add(f),S):!l&&A?(S.delete(f),S):d})},0,Boolean)},[e,s,u]),o.useMemo(()=>Array.from(n),[n])}function g(e,s,t,u,n=1){const r=o.useMemo(()=>c.publicState(e),[e]);return m(r,s,t,u,!1,n)}function k(e,s,t,u=1){const n=o.useMemo(()=>c.publicState(e),[e]);return y(n,s,t,!1,u)}i.useAuthors=P,i.useLocalState=p,i.useNodeState=m,i.usePublicGroupState=k,i.usePublicState=g,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
